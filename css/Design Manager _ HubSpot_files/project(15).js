!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};e[r].call(n.exports,n,n.exports,s);n.l=!0;return n.exports}var r=[{name:"head-dlb/bundle.production.js",path:"head-dlb/static-1.1070/bundle.production.js",ids:{}},{name:"hubspot-dlb/bundle.production.js",path:"hubspot-dlb/static-1.865/bundle.production.js",ids:{enviro:1}}];s.dlbpr=function(e,t){var n=r[e];if(!n.r){n.r=window["__webpack_require_"+n.name+"__"];if(!n.r)throw new Error("dlb "+n.name+" not loaded");n.r.linkDlb(s,n.ids)}return n.r(t)};s.m=e;s.c=t;s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})};s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};s.t=function(e,t){1&t&&(e=s(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);s.r(r);Object.defineProperty(r,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r};s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};s.d(t,"a",t);return t};s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};s.p="//static.hsappstatic.net/live-notifications-embed/static-1.3527/";s(s.s=40)}({0:function(e,t,s){e.exports=s.dlbpr(1,9)},1:function(e,t,s){e.exports=s.dlbpr(0,16)},2:function(e,t,s){e.exports=s.dlbpr(0,5)},3:function(e,t,s){e.exports=s.dlbpr(0,17)},4:function(e,t,s){e.exports=s.dlbpr(1,5)},40:function(e,t,s){"use strict";s.r(t);const r="0.0.9",n="live-notifications";class a extends Error{constructor({message:e,details:t}){super(e);this.details={};this.name="LiveNotificationsError";"captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor);this.details=t||{}}}const i="LIVE_NOTIFICATIONS_DEBUG";let o=!1;const c={localClient:!1,messageDebug:!1,localEmbed:!1,debugUnsupportedClient:!1},d=()=>{if(o)return c;try{if(localStorage&&"true"===localStorage.getItem(i)){c.localClient=!0;c.messageDebug=!0;c.localEmbed=!0;c.debugUnsupportedClient=!1;o=!0;return c}const e=localStorage&&JSON.parse(localStorage.getItem(i)||"{}");if(e){const{localClient:t,messageDebug:s,localEmbed:r,debugUnsupportedClient:n}=e;c.localClient=!0===t;c.messageDebug=!0===s;c.localEmbed=!0===r;c.debugUnsupportedClient=!0===n}o=!0;return c}catch(e){o=!0;return c}};const h=e=>e&&e.xhr,l=(e,{extraData:t,fingerprint:s,tags:r,level:n}={})=>{if(t&&t.error&&h(t.error)){t.status=t.error.status;t.statusText=t.error.statusText;delete t.error}const a=window.Raven;a&&"function"==typeof a.captureException&&a.captureException(e,{fingerprint:s,tags:r||{},extra:t,level:n});d().messageDebug&&console.error(e,t)},u=/(app|local)(-[a-z]{0,2}\d)?\.hubspot(qa)?\.com/,g=(e="")=>{let t,s="";for(let e=0;e<32;e++){t=16*Math.random()|0;8!==e&&12!==e&&16!==e&&20!==e||(s+="-");s+=(12===e?4:16===e?3&t|8:t).toString(16)}return`${e}_${s}`},E=e=>"__shared-worker-versioning-embed-message--"+e,p=e=>({format:E(e),id:g(e)});let _;!function(e){e.TO_EMBED="TO_EMBED";e.FROM_EMBED="FROM_EMBED";e.EMBED_READY="EMBED_READY";e.EMBED_INIT_FAILED="EMBED_INIT_FAILED";e.EMBED_WORKER_CONNECTION_STATUS_UPDATE="EMBED_WORKER_CONNECTION_STATUS_UPDATE"}(_||(_={}));const m=(e,t)=>{const s=E(t);return Boolean(e&&e.id&&e.format===s)},I=e=>Boolean(e.type&&e.type===_.TO_EMBED),S=(e,t)=>Object.assign({},p(e),{type:_.FROM_EMBED,message:t}),b=(e,t)=>Object.assign({},p(e),{type:_.EMBED_READY,payload:t}),f=(e,t)=>Object.assign({},p(e),{type:_.EMBED_INIT_FAILED,payload:t}),T=(e,t,s)=>Object.assign({},p(e),{type:_.EMBED_WORKER_CONNECTION_STATUS_UPDATE,payload:{appData:t,status:s}});function C(e){let t,s=!1;return function(...r){if(!s){s=!0;t=e.apply(this,r)}return t}}const M=(e,t,s=window)=>{s.parent.postMessage(e,t)},R=C((e,t=window)=>!t.parent||!e);class D{constructor(e){this._handleMessage=e=>{if(!(e.origin.match(u)&&e.data&&e.data.message&&m(e.data,this._options.embedName)&&I(e.data)))return;const{data:{message:t}}=e;this._options.onParentMessage(t)};this.sendEmbedReadyMessage=e=>{const{parentOrigin:t,embedName:s,logClientDebug:r}=this._options;if(R(t))return;const n=b(s,e);r("Sending message to embed host "+n.type,n);M(n,t)};this.sendFromEmbedMessage=e=>{const{parentOrigin:t,embedName:s,logClientDebug:r}=this._options;if(!R(t)){r("Sending message to embed host "+e.type,e);M(S(s,e),t)}};this.sendWorkerConnectionStatusUpdateMessage=(e,t)=>{const{parentOrigin:s,embedName:r,logClientDebug:n}=this._options;if(!R(s)){n(`Sending message to embed host ${_.EMBED_WORKER_CONNECTION_STATUS_UPDATE}, status: ${e}`);M(T(r,t,e),s)}};this.sendEmbedInitializationFailedMessage=e=>{const{parentOrigin:t,embedName:s,logClientDebug:r}=this._options;r("Sending message to embed host "+_.EMBED_INIT_FAILED,e);D.sendEmbedInitializationFailedMessage(s,t,e)};this._options=e;window.addEventListener("message",this._handleMessage,!1)}}D.sendEmbedInitializationFailedMessage=(e,t,s)=>{if(R(t))return;const r=f(e,s);M(r,t)};var A=s(0),v=s.n(A),y=s(2),O=s.n(y);let N;function k(){return N?Promise.resolve(N):v()().then(e=>{N=e;O.a.setUserContext({id:e.user.user_id,email:e.user.email,locale:e.user.locale});return e})}const w="REPORT_WORKER_ERROR";function W(e){return e&&e.type===w}const U="REGISTER_PORT_CONNECTION_ACK",L="REGISTER_PORT_CONNECTION_ACK_FAILED",B="HEARTBEAT_REQUEST",P="PORT_CONNECTION_COMPLETE",V=e=>e&&e.type===B;function F(e){return e&&e.type===U}function $(e){return e&&e.type===L}function G(e){return e&&e.type===P}function K(e,t){if(null==e)return{};var s,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++){s=a[r];t.indexOf(s)>=0||(n[s]=e[s])}return n}function j({type:e,name:t,version:s}){return{type:e,format:t+"_shared-worker-versioning",id:g(`${t}_${e}`),version:s}}const x="REGISTER_PORT_CONNECTION",q="UN_REGISTER_PORT_CONNECTION",z="HEARTBEAT_RESPONSE";var Q;!function(e){e.BROADCAST_MESSAGES="BROADCAST_MESSAGES";e.PORT_MESSAGES="PORT_MESSAGES"}(Q||(Q={}));var Y=Q;const H=["name","originConnectionId","appDataVersion","portalId"],J=({name:e,requestId:t,version:s})=>Object.assign({},j({type:z,name:e,version:s}),{destinationConnectionId:B,responseRequest:{requestId:t}});function Z(e){let{name:t,originConnectionId:s,appDataVersion:r,portalId:n}=e,a=K(e,H);return Object.assign({},j({name:t,type:x,version:r}),{messageChannel:Y.BROADCAST_MESSAGES,originConnectionId:s,responseRequest:{type:U},payload:Object.assign({appDataVersion:r,portalId:n},a)})}const X=({originConnectionId:e,appDataVersion:t,name:s})=>Object.assign({},j({type:q,name:s,version:t}),{originConnectionId:e,payload:{appDataVersion:t,name:s}});function ee({url:e,name:t}){const s={worker:null,error:null};try{s.worker=new SharedWorker(e,{name:t,credentials:"include"})}catch(e){s.error=e}return s}const te="Error From WorkerScript",se=({url:e,workerName:t,onMessage:s,onMessageError:r,onWorkerError:n,version:a})=>{const{worker:i,error:o}=ee({name:t,url:e});if(!i||!i.port||o)throw o||new Error("SharedWorker was not created or port is not available");i.onerror=n;i.port.onmessage=e=>{e&&e.data&&V(e.data)?i.port.postMessage(J({name:t,requestId:e.data.id,version:a})):s(e)};i.port.onmessageerror=e=>{const t=e&&e.data?e.data:{};r(new Error("Message Error in Shared Worker Port"),{messageData:t})};return i},re="__live_notifications_message";let ne;!function(e){e.ToServiceWorker="ToServiceWorker";e.FromServiceWorker="FromServiceWorker";e.ToWebWorker="ToWebWorker";e.FromWebWorker="FromWebWorker"}(ne||(ne={}));const ae="OBTAIN_ABLY_AUTH_KEY_RESPONSE",ie="NOTIFICATION_STATUS_UPDATE",oe="CTA_REQUEST_MESSAGE",ce="CTA_RESPONSE_MESSAGE";function de(e){return Boolean(e&&e.metadata&&e.metadata.messageRelay===ne.ToWebWorker)}const he=e=>e&&e.type===oe,le=e=>e&&e.type===ce,ue=[];function ge(){let e="#";for(let t=0;t<3;t++)e+=("0"+Math.floor((1+Math.random())*Math.pow(16,2)/2).toString(16)).slice(-2);return e}class Ee{constructor(e){this._color=ge();this.log=(...e)=>{const t=new Date;let s=`%c${t.getHours()}:${t.getMinutes()}:${t.getSeconds()} [${this._prefix}]: `;if(console.groupCollapsed&&e.length>1){const[t,...r]=e;if(Array.isArray(t)){const[e,r]=t;s+=e;console.groupCollapsed(s,`color:${this._color};`,r)}else{s+=t;console.groupCollapsed(s,`color:${this._color};`)}ue.push(s);ue.concat(r);console.log(...r);console.groupEnd();return}const[r,...n]=e;s+=r;console.log(s,`color:${this._color};`,...n);ue.push(s);ue.concat(n)};this._prefix=e}}const pe=n+"-embed";let _e=void 0,me=!1;const Ie=()=>{if(me)return _e;me=!0;try{if(d().messageDebug){_e=new Ee(pe).log;return _e}}catch(e){}},Se=(...e)=>{const t=Ie();t&&t(...e)};var be=s(3),fe=s.n(be);const Te="/live-notifications-embed",Ce=Te+"/shared-worker.js",Me=C(()=>Boolean(window.SharedWorker)&&Boolean(window.BroadcastChannel));let Re=window.navigator?navigator.userAgent.toLowerCase():"";const De=()=>Re.includes("edge/"),Ae=()=>Re.includes("safari/")&&!Re.includes("chrome/")&&!De(),ve=()=>{if(!navigator||!navigator.userAgent)return!1;const e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)},ye=C(()=>{let e=!1===Me()||Ae()||ve();try{d().debugUnsupportedClient&&(e=!0)}catch(e){}return e});let Oe;!function(e){e.WEB_WORKER="Web";e.SHARED_WORKER="Shared"}(Oe||(Oe={}));function Ne(e){return{responseRequest:{},payload:{},format:re,id:g(re),metadata:{messageRelay:e}}}const ke=(e,t,s)=>Object.assign({},Ne(ne.ToWebWorker),{type:ae,payload:s,destinationConnectionId:t,responseRequest:{requestId:e}}),we=({identity:e,subtypeAction:t,subtypeReason:s,userAction:r,errorDescription:n})=>Object.assign({},Ne(ne.ToWebWorker),{type:ie,payload:{identity:e,subtypeAction:t,subtypeReason:s,userAction:r,errorDescription:n}});var We=s(4),Ue=s(5),Le=s.n(Ue),Be=s(6),Pe=s(7),Ve=s.n(Pe);const Fe=Le()(Object(We.createStack)(Ve.a,Object(Be.retry)(e=>!e||!e.data||![200,403,401,0].includes(e.status),{delay:1e3,maxRetries:3}))),$e="notification-station/general/v1/ably/token-request";function Ge(e){Fe.get($e,{portalId:fe.a.get()}).then(({ablyKey:t,tokenRequest:s})=>{rs.sendMessage(ke(e.id,e.originConnectionId,{ablyDecryptionKeys:t,token:s}))}).catch(t=>{"number"!=typeof t.status&&l(t);rs.sendMessage(ke(e.id,e.originConnectionId,{ablyDecryptionKeys:void 0,token:void 0}))})}var Ke=s(1),je=s.n(Ke);const xe=()=>({enviro:{hublet:je.a.getHublet(),short:je.a.getShort()}}),qe="NOTIFICATION_UPDATES",ze="OBTAIN_ABLY_AUTH_KEY_REQUEST",Qe=e=>Boolean(e&&e.metadata&&e.metadata.messageRelay&&e.metadata.messageRelay===ne.FromWebWorker),Ye=e=>e&&e.type===qe,He=e=>e&&e.type&&e.type===ze;let Je,Ze,Xe,et,tt;!function(e){e.CALLING="CALLING"}(Je||(Je={}));!function(e){e.SHOW_NOTIFICATION="SHOW_NOTIFICATION";e.UPDATE_NOTIFICATION="UPDATE_NOTIFICATION";e.REMOVE_NOTIFICATION="REMOVE_NOTIFICATION"}(Ze||(Ze={}));!function(e){e.UNINITIALIZED="UNINITIALIZED";e.CTA_RESPONSE_REQUESTED="CTA_RESPONSE_REQUESTED";e.CTA_RESPONSE_ERROR="CTA_RESPONSE_ERROR"}(Xe||(Xe={}));!function(e){e.STRING="STRING";e.TRANSLATABLE="TRANSLATABLE";e.DELIVERY_DATA="DELIVERY_DATA";e.ID_DATA="ID_DATA";e.URL="URL";e.CONTACT="CONTACT";e.COMPANY="COMPANY";e.USER="USER";e.DEAL="DEAL";e.TICKET="TICKET";e.QUOTE="QUOTE";e.JSON="JSON";e.PUBLIC_DELIVERY_DATA="PUBLIC_DELIVERY_DATA";e.NUMBER="NUMBER";e.FLAG="FLAG";e.CONTEXTUAL_DATA="CONTEXTUAL_DATA"}(et||(et={}));!function(e){e.CALLING_INBOUND_CALL_NOTIFICATION="CALLING_INBOUND_CALL_NOTIFICATION"}(tt||(tt={}));var st=s(8);const rt=C(()=>{const e=Object(st.parse)(window.location.search.substring(1));return{connectionId:e.connectionId,parentOrigin:decodeURIComponent(e.parentOrigin)}}),nt=e=>{he(e)&&nt(we({identity:e.payload.notificationIdentity,userAction:Xe.CTA_RESPONSE_REQUESTED}));rs.sendMessage(e)},at=e=>{de(e)&&nt(e)},it=new D({embedName:n,parentOrigin:rt().parentOrigin,onParentMessage:at,logClientDebug:Se});function ot(e){let t;try{t=localStorage.getItem(e)}catch(e){}return t}function ct(){const e="CROSS_TAB_TEST_KEY";let t=!!window.localStorage;if(t)try{localStorage.setItem(e,"");localStorage.removeItem(e)}catch(e){t=!1}return t}const dt="CROSS_TAB",ht="CROSS_TAB_DEBUG";function lt(){return"true"===ot(ht)}function ut(e,t){if(lt()){const s=`${dt} - ${e}`;t?console.debug(s,t):console.debug(s)}}function gt(e){return`${e}-${Date.now()}-${Math.random().toFixed(10).substr(2)}`}class Et{constructor(){this.callbacks={}}addEventListener(e,t){this.callbacks[e]||(this.callbacks[e]=[]);this.callbacks[e].push(t)}removeEventListener(e,t){this.callbacks[e]=this.callbacks[e].filter(e=>e!==t)}trigger(e,...t){this.callbacks[e]&&this.callbacks[e].forEach(e=>e(...t))}}class pt{constructor(e){this.handleStorageEvent=this.handleStorageEvent.bind(this);this.eventManager=new Et;this.namespace="";e||!ct()?this.storage=e||{}:window.addEventListener("storage",this.handleStorageEvent)}setNamespace(e){this.namespace=e}setKey(e,t){this.storageKey=e;this.storageSubKey=t}getNamespacedKey(e){return this.namespace?`${this.namespace}-${e}`:e}getItem(e){try{const t=this.getNamespacedKey(e);return this.storage?this.storageKey?this.storage[this.storageKey][this.storageSubKey][t]:this.storage[t]:this.storageKey?JSON.parse(localStorage.getItem(this.storageKey))[this.storageSubKey][t]:JSON.parse(localStorage.getItem(t))}catch(e){ut("Error while reading localStorage value:",e);return null}}setItem(e,t){const s=this.getNamespacedKey(e),r=this.storageKey||s;let n=t;if(this.storageKey){let e;try{e=this.storage?this.storage[this.storageKey][this.storageSubKey]:JSON.parse(localStorage.getItem(this.storageKey))[this.storageSubKey]}catch(t){ut("Error while writing localStorage value:",t);e={}}n={[this.storageSubKey]:Object.assign({},e,{[s]:t})}}if(this.storage){this.storage[r]=n;this.eventManager.trigger(e,t)}else try{localStorage.setItem(r,JSON.stringify(n));this.eventManager.trigger(e,t)}catch(e){}}getArrayItem(e){const t=this.getItem(e);return Array.isArray(t)?t:[]}pushItem(e,t){this.setItem(e,this.getArrayItem(e).concat([t]))}removeArrayItem(e,t){this.setItem(e,this.getArrayItem(e).filter(e=>e!==t))}moveItemToFront(e,t){this.setItem(e,[t,...this.getArrayItem(e).filter(e=>e!==t)])}handleStorageEvent({key:e,newValue:t,oldValue:s}){let r;if(this.storageKey){if(e&&this.storageKey===e){r=null;try{const e=JSON.parse(s)[this.storageSubKey],n=JSON.parse(t)[this.storageSubKey];r=[...Object.keys(e),...Object.keys(n)].find(t=>JSON.stringify(e[t])!==JSON.stringify(n[t]))}catch(e){ut("Error while parsing localStorage value:",e)}}}else r=e;if(r&&r.indexOf(this.namespace)>-1){const e=r.replace(this.namespace+"-","");this.eventManager.trigger(e,this.getItem(e))}}removeItemChangeListener(e,t){this.eventManager.removeEventListener(e,t)}onItemChange(e,t){this.eventManager.addEventListener(e,t)}}const _t=1e3,mt=2*_t,It=3*_t,St="TABS_HEARTBEAT",bt="TABS_MESSAGE",ft="TABS_LIST",Tt="becomeMaster",Ct="surrenderMaster",Mt="anyMessage",Rt="message",Dt="removed";class At{constructor(e,t,s=new pt,r=window){this.checkMasterIsAlive=this.checkMasterIsAlive.bind(this);this.handleReceivedMessage=this.handleReceivedMessage.bind(this);this.handleUpdatedTabs=this.handleUpdatedTabs.bind(this);this.heartbeat=this.heartbeat.bind(this);this.unregister=this.unregister.bind(this);this.currentTab=gt("tab");this.storage=s;this.options=t;s.setNamespace(e);s.setKey(...t.storageKey||[]);this.eventManger=new Et;Object.keys(t).filter(e=>/^on[A-Z]/.test(e)).forEach(e=>{this[e]&&t[e]&&this[e](t[e])});this.storage.onItemChange(bt,this.handleReceivedMessage);if(!this.options.passive){this.storage.onItemChange(ft,this.handleUpdatedTabs);r.addEventListener("beforeunload",this.unregister);this.register();this.checkMasterAliveInterval=setInterval(this.checkMasterIsAlive,mt)}}becomePrimaryTab(){this.isCurrentTabMaster()||this.storage.moveItemToFront(ft,this.currentTab)}checkMasterIsAlive(){const e=this.getMasterTab();if(Date.now()-this.storage.getItem(St)>It){ut(`Master (${e}) removed due to inactivity`);this.storage.removeArrayItem(ft,e)}}didBecomeMasterTab(){ut("Tab is now master");this.eventManger.trigger(Tt);this.heartbeat();this.heartbeatInterval=setInterval(this.heartbeat,_t)}register(){if(this.options.passive)ut("Tab is passive. Won't be registered");else{ut("Registered current tab with id:",this.currentTab);this.storage.pushItem(ft,this.currentTab)}}reRegister(){ut("Current tab was removed from localStorage. Re-registering");clearInterval(this.heartbeatInterval);this.eventManger.trigger(Dt);this.register()}dispatchMessage(e){ut("Dispatching message:",e);this.storage.setItem(bt,{from:this.currentTab,id:gt("message"),message:e})}getMasterTab(){return this.storage.getArrayItem(ft)[0]}isCurrentTabMaster(){return this.getMasterTab()===this.currentTab}isCurrentTabInTabList(){return this.storage.getArrayItem(ft).indexOf(this.currentTab)>-1}handleReceivedMessage(e){if(e){if(e.from!==this.currentTab){ut("Received message:",e);this.eventManger.trigger(Mt,e);e.from===this.getMasterTab()&&this.eventManger.trigger(Rt,e)}}else ut("Received undefined or null message. currentTab: "+this.currentTab)}handleUpdatedTabs(){const e=this.currentMasterTab,t=this.getMasterTab();this.currentMasterTab=t;if(t!==e)if(t===this.currentTab)this.didBecomeMasterTab();else{ut("Master updated:",this.getMasterTab());clearInterval(this.heartbeatInterval);this.eventManger.trigger(Ct)}this.isCurrentTabInTabList()||this.reRegister()}heartbeat(){this.storage.setItem(St,Date.now())}onBecomeMaster(e){this.eventManger.addEventListener(Tt,e)}onSurrenderMaster(e){this.eventManger.addEventListener(Ct,e)}onMessageFromMaster(e){this.eventManger.addEventListener(Rt,e)}onMessage(e){this.eventManger.addEventListener(Mt,e)}onRemoved(e){this.eventManger.addEventListener(Dt,e)}unregister(){this.storage.removeItemChangeListener(ft,this.handleUpdatedTabs);this.storage.removeArrayItem(ft,this.currentTab)}}var vt=At;class yt{constructor(){this.isInitialized=!1;this.isPrimary=!1;this.setupPrimaryTabLocalStorageManagement=()=>{const e="LIVE_NOTIFICATIONS_"+fe.a.get(),t=()=>{this.isPrimary=!0;Se("Primary Client was updated, isPrimary: true")},s=()=>{this.isPrimary=!1;Se("Primary Client was updated, isPrimary: false")};this._crossTab=new vt(e,{onBecomeMaster:t,onSurrenderMaster:s,onRemoved:s})};this.initialize=()=>{if(!this.isInitialized){this.isInitialized=!0;try{this.setupPrimaryTabLocalStorageManagement()}catch(e){}}}}}var Ot=new yt;const Nt=C(g);let kt;!function(e){e.UNINITIALIZED="UNINITIALIZED";e.STARTED="STARTED";e.SUCCEEDED="SUCCEEDED";e.FAILED="FAILED";e.UNSUPPORTED="UNSUPPORTED";e.DISCONNECTING="DISCONNECTING";e.DEPRECATED="DEPRECATED"}(kt||(kt={}));const wt=({channelName:e,onMessage:t,onMessageError:s})=>{if("function"!=typeof BroadcastChannel)return null;const r=new BroadcastChannel(e+"-version-deprecation");r.onmessage=t;r.onmessageerror=e=>{const t=e&&e.data?e.data:{};s(new Error("Message Error in Version Broadcast Channel"),{messageData:t})};return r},Wt=({name:e,workerVersion:t,portalId:s})=>{let r=e;s&&(r+="#"+s);t&&(r+="@"+t);return r},Ut=2e4;let Lt;!function(e){e.MESSAGE_RECIEVED="MESSAGE_RECIEVED";e.MESSAGE_TIMEOUT="MESSAGE_TIMEOUT";e.MESSAGE_ERROR="MESSAGE_ERROR"}(Lt||(Lt={}));function Bt(e){return e.status===Lt.MESSAGE_RECIEVED}function Pt({port:e,inboundPort:t,message:s,errorAckMessageType:r,timeout:n}){return new Promise(a=>{if(!(s.type&&s.originConnectionId&&s.responseRequest&&s.responseRequest.type)){a({status:Lt.MESSAGE_ERROR,responseMessageType:s&&s.responseRequest&&s.responseRequest.type||"unknown",errorMessage:`sendMessageAndAck requires a type an originConnectionId and responseRequest info, recieved: ${s.type}, ${s.originConnectionId}`});return}const i=s.responseRequest.type;let o,c="sendMessageAndAck never received response message type "+i;t||(t=e);const d=e=>{if(Boolean(e.data)&&(e.data.type===i||r&&e.data.type===r))if(e.data.responseRequest.requestId!==s.id||e.data.destinationConnectionId!==s.originConnectionId)c=`sendMessageAndAck recieved Message ${i} with non-matching requestId: ${e.data.responseRequest.requestId!==s.id} or connectionId: ${e.data.destinationConnectionId!==s.originConnectionId} error`;else{t&&t.removeEventListener("message",d);clearTimeout(o);if(e.data.type===r){a({status:Lt.MESSAGE_ERROR,responseMessageType:i,messageEvent:e});return}a({status:Lt.MESSAGE_RECIEVED,responseMessageType:i,messageEvent:e})}else c=`sendMessageAndAck never received response message type ${i}, Last message type is ${e.data&&e.data.type||"unknown"}`};t.addEventListener("message",d);try{e.postMessage(s);o=setTimeout(()=>{t&&t.removeEventListener("message",d);a({status:Lt.MESSAGE_TIMEOUT,responseMessageType:i,errorMessage:c})},"number"==typeof n?n:Ut)}catch(e){t&&t.removeEventListener("message",d);clearTimeout(o);a({status:Lt.MESSAGE_ERROR,responseMessageType:i,errorMessage:`Failed to send postMessage for sync message ${s.type} reason: ${e.message}`});return}})}function Vt(e,t){return Object.assign({},e,{payload:e.payload||{},originConnectionId:t})}function Ft({portalId:e,channelName:t,version:s,onMessageError:r}){const n=new BroadcastChannel(`${t}-to-worker-${s}-${e}`),a=new BroadcastChannel(`${t}-from-worker-${s}-${e}`);n.onmessageerror=e=>{const t=e&&e.data?e.data:{};r(new Error("Message Error in toWorkerChannel Broadcast Channel"),{messageData:t})};a.onmessageerror=e=>{const t=e&&e.data?e.data:{};r(new Error("Message Error in fromWorkerChannel Broadcast Channel"),{messageData:t})};return{toWorkerChannel:n,fromWorkerChannel:a}}class $t{constructor(){this._messageIds={};this.wasMessageIdRecieved=(e,t)=>{if(this._messageIds[e])return!0;this._messageIds[e]=t;setTimeout(()=>{delete this._messageIds[e]},1e4);return!1}}}function Gt(){let e=()=>{},t=()=>{};return{promise:new Promise((s,r)=>{e=s;t=r}),resolve:e,reject:t}}var Kt=Gt;const jt="VERSION_DEPRECATION";function xt(e){return e&&e.type===jt}class qt{constructor(e){this.connectionStatus=kt.UNINITIALIZED;this.DISCONNECTED_REGISTRATION_ERROR_MESSAGE="Registration interrupted by disconnect";this._versionBroadcastChannel=null;this._sharedWorker=null;this._outboundBroadcastChannel=null;this._broadcastChannels=null;this._handleConnectionStatusUpdate=(e,t)=>{this.connectionStatus=e;this._onVersionWorkerStatusUpdate(e,t)};this._sendPortRegistration=()=>{this._debug&&this._debug("Registering connection with SharedWorker");if(this.connectionStatus===kt.DISCONNECTING)return Promise.reject(new Error(this.DISCONNECTED_REGISTRATION_ERROR_MESSAGE));const e=Z(Object.assign({name:this._name,originConnectionId:this._connectionId,appDataVersion:this._appDataVersion,portalId:this._portalId},this._getAdditionalRegistrationInformation()));return Pt({port:this._sharedWorker.port,errorAckMessageType:L,message:e,timeout:1e4})};this._handleSharedWorkerInitialized=e=>{if(this.connectionStatus===kt.DISCONNECTING)throw new Error(this.DISCONNECTED_REGISTRATION_ERROR_MESSAGE);if(!(e.messageEvent&&e.messageEvent.data&&Bt(e)&&F(e.messageEvent.data))){let t,s=e.errorMessage||`${e.responseMessageType} never recieved for an unknown reason, status ${e.status}.`;const r=e.messageEvent&&e.messageEvent.data;if(r&&$(r)){s=`${e.responseMessageType} never recieved, ${r.payload.message}`;t=r.payload.stack}throw new Error(s,{cause:t})}const{data:t}=e.messageEvent;this._debug&&this._debug("SharedWorker registration succeeded");return t.payload};this._messageDuplicateManager=new $t;this._handleMessage=(e,t)=>{const s=t&&t.data||{};if(G(s)){clearTimeout(this._portConnectedDeferredTimeout);this._portConnectedDeferredTimeout=void 0;this._portConnectedDeferred.resolve(void 0);return}const r=s.id,n=!s.destinationConnectionId||s.destinationConnectionId===this._connectionId;r&&n&&!this._messageDuplicateManager.wasMessageIdRecieved(t.data.id,e)&&this._onMessage(t,e)};this._handleVersionBroadcastChannelMessage=e=>{if(!e.data||!xt(e.data)||!e.data.payload)return;const{data:{payload:t}}=e,s=t.portalId===this._portalId,r=t.workerVersion===this._clientVersion;if(this._sharedWorker&&this._versionBroadcastChannel&&t.workerVersion&&s&&!r){this._debug&&this._debug(`Recieved version deprecation message from ${this._versionBroadcastChannel.name},\n        current version is ${this._clientVersion} new version is ${t.workerVersion}`);this.refreshVersionedSharedWorkerClient(t.workerVersion)}};this._resetSharedWorkerConnection=()=>{if(this._sharedWorker){this._sharedWorker.port.postMessage(X({originConnectionId:this._connectionId,name:this._name,appDataVersion:this._appDataVersion}));this._sharedWorker.port.close();this._sharedWorker=null}};this._resetBroadcastMessageChannels=(e=!1)=>{if(e&&this._versionBroadcastChannel){this._versionBroadcastChannel.close();this._versionBroadcastChannel=null}if(this._broadcastChannels){this._broadcastChannels.fromWorkerChannel.close();this._broadcastChannels.toWorkerChannel.close()}this._broadcastChannels=null;this._outboundBroadcastChannel=null};this._onWorkerError=e=>{this._onMessageError(new Error(te),{type:e.type});if(e.message||!this._portConnectedDeferredTimeout);else{clearTimeout(this._portConnectedDeferredTimeout);this._portConnectedDeferredTimeout=void 0;this._portConnectedDeferred.reject(new Error("SharedWorker script fetch error"))}};this.sendMessage=e=>{if(this._sharedWorker){const t=Vt(e,this._connectionId);try{if(!this._outboundBroadcastChannel)throw new Error("outboundBroadcastChannel is not set");this._outboundBroadcastChannel.postMessage(t);this._sharedWorker.port.postMessage(t)}catch(s){this._onMessageError(new Error(`SharedWorkerMessagingClient#sendMessage error unable to send ${t.type}, reason: ${s&&s.message}, status: ${this.connectionStatus}`),{messageToSend:e})}}else this._onMessageError(new Error(`SharedWorkerMessagingClient#sendMessage error unable to send ${e.type}, reason: shared worker does not exist, status: ${this.connectionStatus}`),{messageToSend:e})};this.connect=()=>new Promise((e,t)=>{try{const s=Wt({portalId:this._portalId,name:this._name,workerVersion:this._clientVersion});this._versionBroadcastChannel||(this._versionBroadcastChannel=wt({channelName:this._name,onMessage:this._handleVersionBroadcastChannelMessage,onMessageError:this._onMessageError}));if(!this._outboundBroadcastChannel){this._broadcastChannels=Ft({portalId:this._portalId,channelName:this._name,version:this._clientVersion,onMessageError:this._onMessageError});if(!this._broadcastChannels){t(new Error("BroadcastChannel is unavailable"));return}this._outboundBroadcastChannel=this._broadcastChannels.toWorkerChannel;this._broadcastChannels.fromWorkerChannel.addEventListener("message",this._handleMessage.bind(this,Y.BROADCAST_MESSAGES))}this._sharedWorker=se({url:`${this._sharedWorkerUrl}?v=${this._clientVersion}`,workerName:s,onMessage:this._handleMessage.bind(this,Y.PORT_MESSAGES),onMessageError:this._onMessageError,onWorkerError:this._onWorkerError,version:this._appDataVersion});this._portConnectedDeferredTimeout=setTimeout(()=>{this._portConnectedDeferred.reject(new Error("Port Connected Acknowledgement never recieved from SharedWorker script"))},15e3);this._debug&&this._debug("Opened connection to SharedWorker: "+s);e(void 0)}catch(e){this._debug&&this._debug("Failed to open connection to SharedWorker",e);t(e)}});this.close=()=>{clearTimeout(this._portConnectedDeferredTimeout);this._portConnectedDeferredTimeout=void 0;this._resetBroadcastMessageChannels(!0);this._resetSharedWorkerConnection()};this.open=()=>{let e;this.connectionStatus=kt.STARTED;return this.connect().then(()=>this._portConnectedDeferred.promise).catch(e=>{throw e}).then(this._sendPortRegistration).then(this._handleSharedWorkerInitialized).then(e=>{this.connectionStatus=kt.SUCCEEDED;return e}).catch(t=>{this._resetBroadcastMessageChannels(!0);this._resetSharedWorkerConnection();if(t&&t.message===this.DISCONNECTED_REGISTRATION_ERROR_MESSAGE)throw t;this.connectionStatus=kt.FAILED;if(e)throw e;throw t})};this.refreshVersionedSharedWorkerClient=e=>{this._handleConnectionStatusUpdate(kt.STARTED);this._portConnectedDeferred=Kt();this._clientVersion=e;this._resetSharedWorkerConnection();this._resetBroadcastMessageChannels();this._debug&&this._debug("Refreshing version, new version is "+this._clientVersion);return this.connect().then(()=>this._portConnectedDeferred.promise).then(this._sendPortRegistration).then(this._handleSharedWorkerInitialized).then(e=>{if(!e)throw new Error("WorkerRefresh failed with no data");this._handleConnectionStatusUpdate(kt.SUCCEEDED,e)}).catch(e=>{this._debug&&this._debug("WorkerRefresh failed",e);this._handleConnectionStatusUpdate(kt.FAILED);this._resetBroadcastMessageChannels(!0);this._resetSharedWorkerConnection()})};const{portalId:t,connectionId:s,initialClientVersion:r,name:n,sharedWorkerUrl:a,onMessage:i,onMessageError:o,onVersionWorkerStatusUpdate:c,getAdditionalRegistrationInformation:d,appDataVersion:h,debug:l}=e;this._connectionId=s;this._portalId=t;this._appDataVersion=h;this._debug=l;this._onMessage=i;this._clientVersion=r;this._name=n;this._sharedWorkerUrl=a;this._getAdditionalRegistrationInformation=d;this._onMessageError=o;this._onVersionWorkerStatusUpdate=c;this._portConnectedDeferred=Kt()}get portConnectedDeferred(){return this._portConnectedDeferred}}class zt{constructor(e){this.isInitialized=!1;this.connectionId=Nt();this._disconnected=!1;this.disconnect=e=>{if(!this._disconnected){this._disconnected=!0;this._clientOptions.debug&&this._clientOptions.debug("Disconnecting from SharedWorker");if(!e){window.removeEventListener("beforeunload",this.disconnect);window.removeEventListener("unload",this.disconnect)}this._onDisconnect();this._client&&(this._client.connectionStatus=kt.DISCONNECTING);this._client&&this._client.close()}};this.sendMessage=e=>{if(this._client&&this.isInitialized){this._clientOptions.debug&&this._clientOptions.debug("Sending message to SharedWorker "+e.type,e);this._client.sendMessage(e)}else this._clientOptions.onMessageError(new Error("Message Client does not exist or is not ready"))};this.initialize=(e,t=qt)=>new Promise((s,r)=>{if(!this.isInitialized){this.isInitialized=!0;if(Me()){e&&(this.connectionId=e);this._client=new t(Object.assign({},this._clientOptions,{connectionId:this.connectionId}));window.addEventListener("beforeunload",this.disconnect);window.addEventListener("unload",this.disconnect);this._client.open().then(s).catch(e=>{this._clientOptions.debug&&this._clientOptions.debug("Failed to setup SharedWorker");r(e)})}else{this._clientOptions.debug&&this._clientOptions.debug("SharedWorkers are unsupported");r(new Error("SharedWorkers are "+kt.UNSUPPORTED))}}});const{portalId:t,version:s,name:r,sharedWorkerUrl:n,onMessage:a,onVersionWorkerStatusUpdate:i,onDisconnect:o,onMessageError:c,getAdditionalRegistrationInformation:d,debug:h}=Object.assign({getAdditionalRegistrationInformation:()=>({}),onDisconnect:()=>{},onMessage:()=>{},onMessageError:(e,t)=>{}},e);this.appDataVersion=s;this._clientOptions={portalId:t,onMessage:a,onMessageError:c,initialClientVersion:s,appDataVersion:this.appDataVersion,name:r,onVersionWorkerStatusUpdate:i,getAdditionalRegistrationInformation:d,sharedWorkerUrl:n,debug:h};this._onDisconnect=o}get connectionStatus(){return this._client?this._client.connectionStatus:kt.UNINITIALIZED}}var Qt=s(9);const Yt=C(()=>Object(Qt.createMetricsFactory)("live-notifications",{dimensions:{has_shared_worker_support:""+Me()}}));let Ht;!function(e){e.UNINITIALIZED="UNINITIALIZED";e.LOADING="LOADING";e.SUCCEEDED="SUCCEEDED";e.FAILED="FAILED"}(Ht||(Ht={}));class Jt{constructor(){this.queue=[];this.add=e=>{this.queue.push(e)};this.concat=e=>{this.queue=this.queue.concat(e.queue);e.clear()};this.flush=e=>{this.queue.forEach(([t])=>e(t));this.clear()};this.clear=()=>{this.queue=[]}}getHasQueuedMessages(){return Boolean(this.queue.length)}}function Zt(){return new Jt}const Xt=[kt.STARTED,kt.UNINITIALIZED],es=e=>Xt.includes(e),ts=e=>e===kt.SUCCEEDED;class ss{constructor(){this.messageClientType=ye()?Oe.WEB_WORKER:Oe.SHARED_WORKER;this.isInitialized=!1;this.isDisconnecting=!1;this._messageQueue=Zt();this._authStatus=Ht.UNINITIALIZED;this._ablyTokenRequestMessage=void 0;this._appData={uuid:void 0,data:{}};this._onDisconnect=()=>{this.isDisconnecting=!0};this._handleMessageError=(e,t)=>{if(!e||e.message!==te||t&&(!t||t.message)){Se(e);l(e,{extraData:t});Yt().counter("worker-message-error-received",{connectionStatus:this.connectionStatus}).increment()}else Yt().counter("worker-message-error-received",{connectionStatus:this.connectionStatus}).increment()};this._handleRegisterPortConnectionAck=e=>{Se(`Recieved Registration Message from ${this.messageClientType} Worker`,e);this._appData=e.payload};this._handleReportErrorMessage=e=>{Se(`Recieved Report Error Message from ${this.messageClientType} Worker`,e);const{error:t,extra:s}=e.payload,{metadata:r}=e,n=s||{};"details"in t&&(n.details=t.details);l(t,{extraData:Object.assign({},n,r||{})})};this._handleToClientFromWorkerMessage=e=>{Se(`Recieved Message from ${this.messageClientType} Worker ${e.type}`,e);if(he(e)||le(e))it.sendFromEmbedMessage(e);else if(He(e))this._authStatus===Ht.SUCCEEDED?Ge(e):this._ablyTokenRequestMessage=e;else{if(Ye(e)){this._appData=e.payload.appData;e.payload.isPrimaryClient=Ot.isPrimary}it.sendFromEmbedMessage(e)}};this._handleMessage=e=>{const{data:t}=e;F(t)?this._handleRegisterPortConnectionAck(t):W(t)?this._handleReportErrorMessage(t):he(t)||le(t)?it.sendFromEmbedMessage(t):Qe(t)&&this._handleToClientFromWorkerMessage(t)};this.sendMessage=e=>{ye()||(es(this.connectionStatus)?this._messageQueue.add([e]):ts(this.connectionStatus)&&this._messageClient.sendMessage(e))};this.handleVersionWorkerStatusUpdate=(e,t)=>{t&&(this._appData=t);it.sendWorkerConnectionStatusUpdateMessage(e,this._appData)};this._messageClient=new zt({debug:Se,portalId:""+fe.a.get(),version:r,name:n,sharedWorkerUrl:Ce,onMessage:this._handleMessage,onVersionWorkerStatusUpdate:this.handleVersionWorkerStatusUpdate,onMessageError:this._handleMessageError,getAdditionalRegistrationInformation:xe,onDisconnect:this._onDisconnect})}set authStatus(e){const t=this._authStatus;this._authStatus=e;t!==Ht.SUCCEEDED&&e===Ht.SUCCEEDED&&this._ablyTokenRequestMessage&&Ge(this._ablyTokenRequestMessage)}get connectionStatus(){return this._messageClient.connectionStatus}get messageQueue(){return this._messageQueue}getAppData(){return this._appData}initialize(){if(this.isInitialized||ye())return Promise.resolve(this._appData);this.isInitialized=!0;return this._messageClient.initialize(rt().connectionId).then(e=>{Ot.initialize();this._messageQueue.getHasQueuedMessages()&&this._messageQueue.flush(this.sendMessage);return e}).catch(e=>{this._messageQueue.clear();throw new a({message:"SharedWorkerConnection, "+(e&&e.message||"unknown reason"),details:{error:e}})})}}var rs=new ss;function ns(){try{if(performance&&"function"==typeof performance.mark&&"function"==typeof performance.measure){performance.mark("mark_live_notifications_embed_load_end");const e=performance.measure("mark_live_notifications_embed_load","mark_live_notifications_embed_load_start","mark_live_notifications_embed_load_end");Yt().timer("embed-initialized",{isSharedWorker:"true"}).update(e.duration);Se("init duration: "+e.duration)}}catch(e){}}class as{constructor(){this.startCrossTabServices=()=>rs.initialize().then(e=>{it.sendEmbedReadyMessage(e);ns();return{failed:!1}}).catch(e=>{it.sendEmbedInitializationFailedMessage();if(e){const t=new a({message:"Embed setup failed at "+e.message,details:{message:e.message}});let s="LiveNotificationsError"===e.name?"LIVE_NOTIFICATIONS_ERROR":"GENERIC_ERROR";e.message.includes(U)&&(s=U+"_ERROR");l(t,{extraData:{error:e,isSharedWorker:!0},fingerprint:[e.message,s]})}return{failed:!0}});this.initUserInfo=()=>{rs.authStatus=Ht.LOADING;return k().then(()=>{rs.authStatus=Ht.SUCCEEDED;return{failed:!1}}).catch(e=>{rs.authStatus=Ht.FAILED;if(!e.status||[401,403,0].includes(e.status))return{failed:!0};const t=new a({message:"Embed setup failed at User Info, "+e.status});e.stack&&(t.stack=e.stack);l(t,{level:"info"});return{failed:!0}})}}start(){Promise.all([this.initUserInfo(),this.startCrossTabServices()]).then(([e,t])=>{t.failed&&Yt().counter("embed-failed",{userInfoFailed:""+e.failed,isSharedWorkerClient:"true"}).increment();e.failed&&Yt().counter("embed-auth-failed",{crosstabServiceFailed:""+t.failed,isSharedWorkerClient:"true"}).increment()}).catch(e=>{l(new a({message:"Unhandled Live Notifications start embed error"}),{extraData:{error:e}})})}}try{(new as).start()}catch(e){l(new a({message:"Failed to call App#start"}),{extraData:{error:e}});D.sendEmbedInitializationFailedMessage(n,rt().parentOrigin)}},5:function(e,t,s){e.exports=s.dlbpr(1,13)},6:function(e,t,s){e.exports=s.dlbpr(1,19)},7:function(e,t,s){e.exports=s.dlbpr(1,83)},8:function(e,t,s){e.exports=s.dlbpr(1,21)},9:function(e,t,s){e.exports=s.dlbpr(1,31)}});